**Tags:** 
____
**Date:** 02.06.2023
**Time:** 12:02
```toc style:
bullet | number | inline (default: bullet) min_depth: number (default: 2) max_depth: number (default: 6) title: string (default: undefined) allow_inconsistent_headings: boolean (default: false) delimiter: string (default: |) varied_style: boolean (default: false)
```
____
![[4. Сбалансированные ДДП. АВЛ-дерево.#Сбалансированные ДДП]]


## Красно-черные деревья
Это вариант ДДП. В отличии от [[4. Сбалансированные ДДП. АВЛ-дерево.|AVL-деревьев]] имеет меньшую "жесткость" при балансировке.
+ Каждая вершина имеет цвет.(Красный/Черный)
+ Уровни любых двух листьев отличаются не более чем в два раза
+ Вставка/Замена элемента влечет за собой дополнительные действия
+ Все листья это NIL вершина черного цвета. Операции вызовов потомков и проверки уровня для них имеют смысл, однако сам NIL иметь потомков не может
+ Если вершина красная, то оба ее потомка черные
+ Корень имеет черный цвет
+ Путь - количество черных листьев

### Добавление вершины
1. Найти место для вершины
2. Добавить ее с красным цветом
3. Восстановить свойства КЧД путем вращений и перекрашиваний
Получаем, что после добавления на 2 этапе у нас может нарушиться свойство о том, что у красной вершины все потомки черные. При таком нарушении может возникнуть четыре варианта расположения узлов. Важно лишь понимать, что сын, отец - красный цвет, а дедушка уже черный, потому что до добавления вершины дерево уже было сбалансировано

#### Случай 1
![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602124219.png|500]]
Или
![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602124241.png|500]]

Первый случай заключается в том, что дядя тоже красный и мы просто меняем цвет папы, дяди и деда. Получаем, что результат не зависит от того, с какой стороны от папы у нас сын. 

#### Случай 2
![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602125834.png|500]]
Этот случай работает, когда сын слева от папы и папа слева от деда. Тут прикол в том, что дядя черный, а папа красный. Для решения проблемы делаем правый поворот для папы и перекрашиваем папу и деда. Важно заметить, что тут чернота исходной позиции деда не изменяется и идти наверх не надо.

![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602125849.png|500]]
Этот случай так же работает, когда сын справа и папа справа тоже. Работает точно так же, но для папы делаешь левый поворот и красишь соответственно.

#### Случай 3
![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602131807.png|600]]
Случай 3 работает, когда сын правее папы, а папа левее деда. Делаем поворот левый для сына, получаем, что сын - папа, потом по схеме из предыдущего случая
![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602132328.png|600]]
Случай 3 так же работает в случае, если сын левее папа, который правее деда. Опять же:
1. Поворот для сына правый
2. Поворот для папы левый
3. Перекрашиваем

### Удаление
+ Удаление красной вершины ничего не влечет за собой, потому что у черной вершины может быть любой потомок, а путь не изменится. 
+ Удаление черной вершины влечет за собой уменьшение пути и потенциальную ошибку в виде **красной->красной** вершине, однако выкидывать нельзя и чернота либо передается красной, либо выкидывается после перестановки.


1. Удалили красную вершину?
	- Да -> значит у нас никаких новых проблем возникнуть не может
2. Нет, значит нам надо проверить, что ничего не сломалось и вернуть старую черную высоту.
3. Брат - черный? 
	- Да, тогда просто перекрашиваем его в красный и отца красим в черный.
4. Нет, значит надо добиться, чтобы брат был черным. Левый поворот.
5. Дети брата - черные?
	- Да, значит мы можем перекрасить брата в красный и поднять черный наверх
6. Нет, правый ребенок черный?
	- Да, значит сделаем правый поворот и сделаем черным
7. Нет. Значит мы можем сделать левый поворот.



#### Случай 1
![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602134633.png|600]]
Случай, когда брат красный, а ты черный обыгрывается так:
1. Брат и папа меняются цветами
2. Делается левое вращение вокруг родителя
#### Случай 2
![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602135706.png|600]]
Убираем лишнюю черноту из вершины брата и делаем его красным, а вершину папы черным
#### Случай 3
![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602140905.png|600]]
Отсюда случай 3 сводится к случаю 4

#### Случай 4
![[Картинки/╨Ъ╨░╤А╤В╨╕╨╜╨║╨╕/Pasted image 20230602141149.png|600]]

+ Случаи, когда «брат» является левым потомком, симметричны рассмотренным случаям.

### Преимущества красно-чёрных деревьев
1. При вставке выполняется не более O(1) вращений. Примерно половина вставок и удалений произойдут без преобразований. 
2. Процедуру балансировки практически всегда можно выполнять параллельно с процедурами поиска, так как алгоритм поиска не зависит от атрибута цвета узлов. 
3. Сбалансированность этих деревьев хуже, чем у АВЛ, но работа по поддержанию сбалансированности в красно-чёрных деревьях обычно эффективнее. Для балансировки красно-чёрного дерева производится минимальная работа по сравнению с АВЛ-деревьями. 
4. Используется всего 1 бит дополнительной памяти для хранения цвета вершины.

## Список ссылок
____
**Zero-links:**
+ [[00_Алгоритмы и структуры данных]]

**Links:**
+ [[4. Сбалансированные ДДП. АВЛ-дерево.]]
+ [[3. Двоичные деревья поиска (ДДП).]]